<Simulation
    simName = "Density"
    inputFromResults = "1"
    wtDistEps = "-1e-10"
    >
  <InputWF
      cutoff = "1"
      interpolation = "(step(r)-step(r-0.2))*(1-(150/23)*r^2+(375/23)*r^4)+(step(r-0.2)-step(r-0.6))*(2/23)*(11-5*r*(-2+5*r*(6+5*r*(r-2))))+step(r-0.6)*(125/46)*(r-1)^4"
      selfContribution = "2875/(256*pi)"
      weight = "(15625/(1024*pi))*((step(r)-step(r-0.2))*48*(0.2-r^2)+(step(r-0.2)-step(r-0.6))*(19.2-0.64/r-48*r+32*r^2)+step(r-0.6)*(-8*(r-1)^3)/r)"
      name = "M5"
      />

  <Controller
      timesteps = "1"
      dt = "0.005"
      >
    <IntegratorVelocityVerlet
        species="fluid"
        lambda = "1"
        />
    <IntegratorScalarLambda
        species = "fluid"
        lambda = "1"
        scalar = "n"
        symbol = "n"
        />
         
  </Controller>

  <ParticleScalar
      species = "fluid"
      expression = "640+(750-640)*xCoord([r])/3.3846153846153837"
      symbol = "temperatureIn"
      />
  <ParticleScalar
      species = "fluid"
      expression = "740"
      symbol = "temperatureConstIn"
      />
  <ParticleScalar
      species = "fluid"
      expression = "360"
      symbol = "rhoConstIn"
      />
  <ParticleScalar
      species = "fluid"
      expression = "23000000+(25000000-23000000)*xCoord([r])/3.3846153846153837"
      symbol = "pressureIn"
      />
  <ParticleScalar
      species = "fluid"
      expression = "24000000"
      symbol = "pressureConstIn"
      />
  <ParticleScalar
      species = "fluid"
      expression = "350+(650-350)*xCoord([r])/3.3846153846153837"
      symbol = "rhoIn"
      />

<!-- Density Calculation -->
  <PCacheIAPWSIF97rho
      species = "fluid"
      var1 = "pressureConstIn"      
      var2 = "temperatureIn"
      var2Max = "750"
      var2Min = "640"
      var1Max = "25000000"
      var1Min = "23000000"
      LUTsizeVar1 = "20"
      LUTsizeVar2 = "20" 
      symbol = "rhoVsTOut"
      />

<!-- Pressure Calculation -->
  <PCacheIAPWSIF97p
      species = "fluid"
      var1 = "rhoConstIn"      
      var2 = "temperatureIn"
      var2Max = "750"
      var2Min = "640"
      var1Max = "650"
      var1Min = "350"
      LUTsizeVar1 = "20"
      LUTsizeVar2 = "20" 
      symbol = "pressureVsTOut"
      />
  
<!-- Viscosity Calculation -->
  <PCacheIAPWSIF97eta
      species = "fluid"
      var1 = "rhoConstIn"      
      var2 = "temperatureIn"
      var2Max = "750"
      var2Min = "640"
      var1Max = "650"
      var1Min = "350"
      LUTsizeVar1 = "20"
      LUTsizeVar2 = "20" 
      symbol = "etaVsTOut"
      />
  
<!-- Viscosity Calculation -->
  <PCacheIAPWSIF97kappa
      species = "fluid"
      var1 = "rhoConstIn"      
      var2 = "temperatureIn"
      var2Max = "750"
      var2Min = "640"
      var1Max = "650"
      var1Min = "350"
      LUTsizeVar1 = "20"
      LUTsizeVar2 = "20" 
      symbol = "kappaVsTOut"
      />
  
  <Phase
      smartCells = "0"
      >
    <LinkedListCreator/>

    <BoundaryCuboid
        boxX = "3.076923"
        boxY = "2.3076923077"
        boxZ = "2.3076923077"
        periodicX = "yes"
        periodicY = "yes"
        periodicZ = "yes"
        >

      <ReflectorMirror/>

      <!-- This should produce only 8 particles aligned along x -->
      <ParticleCreatorLattice
          species = "fluid"
          density = "17.576"
          n = "17.576"
          u = "0"
          v = "0"
          w = "0"
	  y = "y+step(y-0.3)*1000"
	  z = "z+step(z-0.3)*1000"
          />

    </BoundaryCuboid>

  </Phase>

  <GridAveragerStructured
      nX = "8"
      nY = "1"
      nZ = "1"
      measureEvery = "1"
      fromStepOn = "1"
      >
    
    <Scalar symbol = "temperatureIn" species = "fluid"/>
    <Scalar symbol = "pressureIn" species = "fluid"/>
    <Scalar symbol = "rhoIn" species = "fluid"/>
    <Scalar symbol = "rhoVsTOut" species = "fluid"/>
    <Scalar symbol = "pressureVsTOut" species = "fluid"/>
    <Scalar symbol = "etaVsTOut" species = "fluid"/>
    <Scalar symbol = "kappaVsTOut" species = "fluid"/>
    
    <!-- The names of the columns of the measurements are auto-generated by the Meter. The "^1" stands for the moment, i.e., here the first, i.e., the average (can be changed in the sub-module 'Scalar'). -->

<!-- NOTE FOR THE TESTSUITE: For reasonably formatted results, multipleFiles = "yes" is preferable, and it was checked that the results are very close to the ones obtained from the NIST webbook (http://webbook.nist.gov/chemistry/fluid/). For the testsuite we have chosen multipleFiles = "no" to avoid the addition of a counter to the file name. -->
    
    <OutputFile nameOutputFile = "pca_iapws-if97.dat" multipleFiles = "no"  columns = "cell_positions|fluid_temperatureIn^1|fluid_pressureIn^1|fluid_rhoIn^1|fluid_rhoVsTOut^1|fluid_pressureVsTOut^1|fluid_etaVsTOut^1|fluid_kappaVsTOut^1"/>

  </GridAveragerStructured>

  <MeterPosVel measureEvery="1" species="fluid" fromStepOn="1">
   <!--

    <OutputFile 
        nameOutputFile = "density_calculation.dat" 
        columns = "densityOut|pressureOut"
        writeHead = "yes" 
        multipleFiles = "no"  
        />
-->

   <OutputVTK nameOutputFile = "pos.vtk"/>
   
</MeterPosVel>

</Simulation>
